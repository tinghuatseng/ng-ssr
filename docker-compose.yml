version: '3.8'

services:
  # 我們的 Angular SSR 應用程式服務
  app:
    # 使用當前目錄的 Dockerfile 進行建置
    build: .
    container_name: ng-ssr-app
    restart: unless-stopped

  # Nginx 服務
  nginx:
    # 直接使用 Docker Hub 上的官方 Nginx 映像
    image: nginx:alpine
    container_name: ng-ssr-nginx
    restart: unless-stopped
    ports:
      # 將主機的 8080 埠對應到容器的 80 埠
      - "8080:80"
    volumes:
      # 將主機的 nginx.conf 掛載到容器中，覆蓋預設設定
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
      # 將應用程式建置好的靜態檔案目錄掛載到 Nginx 的網站根目錄
      - ./dist/ng-ssr/browser:/usr/share/nginx/html:ro
    # 確保 app 服務先於 nginx 啟動
    depends_on:
      - app
